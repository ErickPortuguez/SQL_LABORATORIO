/*NOTA RAPIDA
USUARIO:     ADMIN
CONTRASEÑA:  ADMIN     
*/


/* Crear tablespace dBDivermax */
CREATE TABLESPACE tbs_dbDivermax
DATAFILE 'tbs_dBDivermax'
SIZE 500M;

/* Permitor ejecución de script */
ALTER SESSION SET "_ORACLE_SCRIPT" = TRUE;

/* Crear usuario */
CREATE USER ADMIN
IDENTIFIED BY ADMIN
DEFAULT TABLESPACE tbs_dbDivermax    
TEMPORARY TABLESPACE TEMP
QUOTA UNLIMITED ON tbs_dbDivermax;

/* Determinar los privilegios del usuario */
GRANT CREATE SESSION TO ADMIN;
GRANT CREATE TABLE TO ADMIN;
GRANT CREATE VIEW TO ADMIN;
GRANT CREATE PROCEDURE TO ADMIN;
GRANT CREATE TRIGGER TO ADMIN;
GRANT CREATE SEQUENCE TO ADMIN;
GRANT CREATE JOB TO ADMIN;
GRANT UNLIMITED TABLESPACE TO ADMIN;


create table CLIENTE
(
    idcli  INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    nomcli VARCHAR2(80),
    apecli VARCHAR2(80),
    emacli VARCHAR2(80),
    dnicli CHAR(8),
    celcli CHAR(9),
    estcli CHAR(1) DEFAULT 'A'
    );
    
    

create table EMPLEADO
(
    idemp  INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    nomemp VARCHAR2(80),
    apeemp VARCHAR2(80),
    emaemp VARCHAR2(80),
    dniemp CHAR(8),
    celemp CHAR(9),
    estemp CHAR(1)DEFAULT 'A'
    );
    
    
    

create table PAQUETES
(
    idpaq INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    nompaq VARCHAR2(80),
    prepaq DECIMAL(8,2),
    despaq VARCHAR2(300),
    estpaq char(1)DEFAULT 'A'
);


create table ACTIVIDADES
(
    idact INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    nomact VARCHAR2(80),
    preact DECIMAL(8,2),
    desact VARCHAR2(300),
    estact char(1)DEFAULT 'A'
);



create table RESERVAS
(
    idres INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    fecres VARCHAR2(300),
    idcli int references cliente(idcli),
    TIPPAGRES VARCHAR2(50),
    pagres DECIMAL(8,2),
    estres char(1)DEFAULT 'A'
    
);



create table RESERVAS_DETALLE
(
    idresdet INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    idpaq int references paquetes(idpaq),
    idact int references actividades(idact),
    idres int references reservas(idres),
    CANRES INT ,
    ESTRESDET CHAR(1)DEFAULT 'A'
);



create table PAQUETES_DETALLE
(
    idpaqdet INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    idpaq int references paquetes(idpaq),
    idact int references actividades(idact),
    ESTPAQDET CHAR(1) DEFAULT 'A'
);



create table venta
(
    idven INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    fecven varchar2(20),
    idemp int references empleado(idemp),
    estven char(1)DEFAULT 'A'
);



create table VENTA_DETALLE
(
    idvendet INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
    idven int references venta(idven),
    idres int references reservas(idres),
    ESTVENDET CHAR(1)DEFAULT 'A'
);


/* INSERTAR REGISTROS DE CLIENTE */

INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Juana','Zavala Olaya','juana@gmail.com','72530589','98542631');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Marcos','Arredondo Palomino','marcos@gmail.com ','45123697','945123697');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Alexis','Rodriguez Huaman','alexis@hotmail.com','12345678','900654789');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Pedro','Mantilla Porras ','Pedro@hotmail.com','78451263','936521478');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Rodrigo','Sanchez Padilla','Rodri@gmail.com','45277863','972165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Jeferson','Torres Padilla','Jeff@gmail.com','05317863','992165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Ana','Huaman remuzgo','Ana@hotmail.com','45117863','982165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Lisa','Granada borjas','Lisa@gmail.com','55217863','942165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Marcos','Sanchez lopez','Marcos@hotmail.com','45217863','962165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Manuel','Torres Porras','Manuel@gmail.com','65217863','922165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Lucifer','Estrella de la mañana','Lucif@hotmail.com','45217863','912165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Miguel','Ramos Centeno','Miguel@gmail.com','95217863','942165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Imanol','Lévano Simón','Imanol@hotmail.com','85217863','992165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Gerack','Naivares Torres','gerack@gmail.com','55217863','962165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Dario','Cañita Huaman','Dario@hotmail.com','35217863','922165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Eythan','Portuguez cordero','eythan@gmail.com','05217863','992164487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Maria',' Padilla Torres','Mirtha@gmail.com','45478638','932165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Alexia','De los angeles Remuzgo','Mirtha@gmail.com','45117863','932165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Roxana',' Padilla Rodriguez','Mirtha@gmail.com','45288863','932165487');
INSERT INTO CLIENTE( NOMCLI, APECLI, EMACLI, DNICLI, CELCLI)VALUES('Rosaa','Huaman Padilla','Rosa@gmail.com','45292863','912165487');

SELECT * FROM CLIENTE;





/* INSERTAR REGISTOS DE EMPLEADOS */

INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('juan','Porras Ortega','99564865','juan@gmail.com','928794535');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Pedro','Porras Luyo', '12345678','pedro@gmail.com','978506127');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Julian','Talla Sandoval', '12445678','julian@gmail.com','990456124');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Maximo','Ramirez Damian', '19346678','max@gmail.com','978456150');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Luis','Juscamayta Torres', '12245678','Luis@gmail.com','978470120');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Raquel','Huaman Arias', '12345778','raquel@gmail.com','922456122');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Estefany','Sanchez Portuguez ', '18345678','Teffa@gmail.com','978306128');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Jesus','Canales Quiroz', '12341678','Jesus@gmail.com','910056163');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Judas','De la cruz sandoval', '52345678','judas@gmail.com','900000026');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Liam','Carrazco Caceres', '92345078','liam@gmail.com','970456107');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Erick','Portuguez Zavala', '72345678','erick@gmail.com','908450124');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Johan','Portuguez Zavala', '62345678','johan@gmail.com','974456109');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Gemma','Talla Zavala', '52305678','gemma@gmail.com','978456125');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Aldo','Portuguez Zavala', '42390678','Aldo@gmail.com','978456124');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Maria','Cordero Montes', '42405678','Maria@gmail.com','918459003');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Alexandra','Lozano Sandoval', '62345678','Ale@gmail.com','973006123');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Alina','Lozano Sandoval', '72345678','Alina@gmail.com','978357412');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Dayana','Cordero Montes', '02345678','Dayana@gmail.com','950046123');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Ruben','Apari Carrazco', '12445678','Ruben@gmail.com','940055123');
INSERT INTO EMPLEADO(NOMEMP,APEEMP,DNIEMP,EMAEMP,CELEMP)VALUES('Joaquin','Portuguez cordero', '10345678','joaquin@gmail.com','923456123');

SELECT * FROM EMPLEADO;







/* INSERTAR REGISTROS DE ACTIVIDADES */

INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT) VALUES ('CANOTAJE',15.00,'Aventuras en votes a tu gusto');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('CUATRIMOTO',20.00,'Vive la adrenalina extrema con nosotros');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('PASEO A CABALLO',20.00,'Vive la adrenalina extrema con nosotros ');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('CUATRIMOTO DOBLE',30.00,'Vive la adrenalina extrema con nosotros');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('CANOPY',40.00,'Vive la adrenalina extrema con nosotros ');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('RAPPEL',50.00,'Vive la adrenalina extrema con nosotros ');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('PASEO TURISTICO',30.00,'Vive la adrenalina extrema con nosotros');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('ESCALERA AL CIELO',60.00,'EXCLUCIVO PARA LOS PAQUETES ');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('VICICLETA EXTREMA',65.00,'EXCLUCIVO PARA LOS PAQUETES ');
INSERT INTO ACTIVIDADES(NOMACT,PREACT,DESACT)VALUES('PUENTE TIBETANO',40.00,'EXCLUCIVO PARA LOS PAQUETES ');

SELECT * FROM ACTIVIDADES;







/* INSERTAR REGISTROS EN PAQUETES */

INSERT INTO PAQUETES(NOMPAQ,PREPAQ,DESPAQ) VALUES ('FAMILIAR VERANO',45.00,'DISFRUTA AL MAXIMO EN FAMILIA');
INSERT INTO PAQUETES(NOMPAQ,PREPAQ,DESPAQ) VALUES ('SOLO PARA VALIENTES',60.00,'ESCALA,MOTO, CANOTAJE');
INSERT INTO PAQUETES(NOMPAQ,PREPAQ,DESPAQ) VALUES ('PAQUETE 1',50.00,'CANOTAJE Y MOTO');
INSERT INTO PAQUETES(NOMPAQ,PREPAQ,DESPAQ) VALUES ('PAQUETE 2',30.00,'CANOTAJE, MOTO Y PASEO TURÍSCTICO');
INSERT INTO PAQUETES(NOMPAQ,PREPAQ,DESPAQ) VALUES ('PAQUETE 3',70.00,'PASEO POR CASAS ABANDONADAS');
INSERT INTO PAQUETES(NOMPAQ,PREPAQ,DESPAQ) VALUES ('LIBERTAD AL MAXIMO',80.00,'CANOTAJE,CUATRIMOTO,PASEO TUÍSTICO,CANOPY Y RAPPEL');
INSERT INTO PAQUETES(NOMPAQ,PREPAQ,DESPAQ) VALUES ('PAQUETE DE AMIGOS',70.00,'PUENTE TIBERIANO,CANOPY+PAQUETE 2');

SELECT * FROM PAQUETES;




/* INSERTAR PAQUETES_DEATELLES */ 


INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('1','1');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('1','2');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('2','1');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('2','2');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('2','7');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('3','1');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('3','2');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('3','7');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('3','5');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('4','1');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('4','2');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('4','7');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('4','5');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('4','6');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('5','10');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('5','5');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('6','8');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('6','6');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('6','5');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('7','8');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('7','5');
INSERT INTO PAQUETES_DETALLE(IDPAQ,IDACT)VALUES('7','9');

SELECT * FROM PAQUETES_DETALLE;

SELECT 
IDPAQDET AS CONTADOR,
ACTIVIDADES.NOMACT AS ACTIVIDAD,
PAQUETES.NOMPAQ AS PAQUETES
FROM PAQUETES_DETALLE
INNER JOIN PAQUETES
ON PAQUETES_DETALLE.IDPAQ = PAQUETES.IDPAQ
INNER JOIN ACTIVIDADES
ON PAQUETES_DETALLE.IDACT = ACTIVIDADES.IDACT
ORDER BY 1;

/*EXPRESIONES REGULARES*/

/*Esta consulta busca todas las filas en la tabla "Cliente" donde el nombre del cliente comienza con la letra "A".*/
SELECT *
FROM CLIENTE
WHERE REGEXP_LIKE(NOMCLI, '^A.*$');

/*Esta consulta busca todas las filas en la tabla "Cliente" donde el correo electrónico es válido según el patrón especificado.*/
SELECT *
FROM CLIENTE
WHERE REGEXP_LIKE(EMACLI, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$');

/*Esta consulta busca todas las filas en la tabla "cliente" donde el número de identificación tiene 8 dígitos seguidos de una letra mayúscula.*/
SELECT *
FROM CLIENTE
WHERE REGEXP_LIKE(DNICLI, '^\d{8}[A-Z]$');

SELECT*FROM CLIENTE;





















/*PRIVILEGIOS REGULARES*/
/*Permite a los usuarios seleccionar (leer) datos de la tabla "cliente".*/
GRANT SELECT ON CLIENTE TO ADMIN;


/* Permite a los usuarios actualizar los valores de los registros en la tabla "cliente".*/
GRANT UPDATE ON CLIENTE TO ADMIN;

/*Permite a los usuarios eliminar registros de la tabla "cliente".*/

GRANT DELETE ON CLIENTE TO ADMIN;

/*Permite a los usuarios insertar registros de la tabla "cliente".*/

GRANT INSERT ON CLIENTE TO ADMIN;

/* PARA REVOCAR LOS PRIVILEGIOS AL USUARIO ADMIN*/

REVOKE SELECT ON CLIENTE FROM ADMIN;
REVOKE UPDATE ON CLIENTE FROM ADMIN;
REVOKE DELETE ON CLIENTE FROM ADMIN;
REVOKE INSERT ON CLIENTE FROM ADMIN;

/*PARA VER SI LOS PRIVILEGIOS SELECT HAN SIDO REVOCADOS DE  ADMIN EN LA TABLA CLIENTE*/


SELECT * 
FROM USER_TAB_PRIVS 
WHERE PRIVILEGE = 'SELECT'
  AND TABLE_NAME = 'CLIENTE';


/* PARA VERIFICAR SI LOS PRIVILEGIOS DELETE HAN SIDOS REVOCADOS DE ADMIN EN LA TABLA CLIENTE*/

SELECT * 
FROM USER_TAB_PRIVS 
WHERE PRIVILEGE = 'DELETE'
  AND TABLE_NAME = 'nombre_tabla';
  
  
/* PARA VERIFICAR SI LOS PRIVILEGIOS UPDATE HAN SIDO REVOCADOS DE ADMIN EN LA TABLA CLIENTE*/


SELECT * 
FROM USER_TAB_PRIVS 
WHERE PRIVILEGE = 'UPDATE'
  AND TABLE_NAME = 'CLIENTE';

/* PARA VERIFICAR SI LOS PRIVILEGIOS INSERT HAN SIDOS REVOCADOS DE ADMIN EN LA TABLA CLIENTE*/

SELECT * 
FROM USER_TAB_PRIVS 
WHERE PRIVILEGE = 'INSERT'
  AND TABLE_NAME = 'nombre_tabla';

/*GRACIAS TOTALES/*
